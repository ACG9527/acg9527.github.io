
<style>
    #TableOfContents > ul, ol {
        ul, ol {
            display: none;
        }
        .open {
            display: block;
        }
    }
</style>

<script>
    function initTocHide() {
        // 判断是否存在文章目录
        let toc = document.querySelector(".widget--toc");
        if (!toc) {
            return;
        }
        // 监听滚动
        window.addEventListener('scroll', function() {
            //清除class值
            let openUl = document.querySelectorAll(".open");
            if (openUl.length > 0) {
              openUl.forEach((ul) => {
                ul.classList.remove("open")
              })
            }
            // 获取active-class
            let currentLi = document.querySelector(".active-class");
            if (!currentLi) {
                return
            }
            // 展示子ul
            if (currentLi.children.length > 1) {
                currentLi.children[1].classList.add("open")
            }
            // 展示父ul
            let ul = currentLi.parentElement;
            do {
                ul.classList.add("open");
                ul = ul.parentElement.parentElement
            } while (ul !== undefined && (ul.localName === 'ul' || ul.localName === 'ol'))
        });
    }
    initTocHide()
</script>

<style>
    #backTopBtn {
        display: none;
        position: fixed;
        bottom: 30px;
        z-index: 99;
        cursor: pointer;
        width: 30px;
        height: 30px;
        background-image: url({{ (resources.Get "icons/backTop.svg").Permalink }});
    }
</style>

<script>
    /**
     * 滚动回顶部初始化
     */
    function initScrollTop() {
        let rightSideBar = document.querySelector(".right-sidebar");
        if (!rightSideBar) {
            return;
        }
        // 添加返回顶部按钮到右侧边栏
        let btn = document.createElement("div");
        btn.id = "backTopBtn";
        btn.onclick = backToTop
        rightSideBar.appendChild(btn)
        // 滚动监听
        window.onscroll = function() {
            // 当网页向下滑动 20px 出现"返回顶部" 按钮
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        };
    }

    /**
     * 返回顶部
     */
    function backToTop(){
        window.scrollTo({ top: 0, behavior: "smooth" })
    }

    initScrollTop();
</script>

<!-- Mobile back button -->
<div class="mobile-back" onclick="history.back()">
  <span class="arrow">‹</span> 返回
</div>

<style>
  /* 只在窄屏显示（手机） */
  @media (max-width: 768px) {
    .mobile-back{
      position: fixed;
      left: 16px;
      top: 72px;            /* 这里自己微调，避开浏览器顶部栏 */
      z-index: 9999;
      background: rgba(255,255,255,.92);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(0,0,0,.06);
      border-radius: 12px;
      padding: 10px 14px;
      font-size: 14px;
      line-height: 1;
      box-shadow: 0 8px 24px rgba(0,0,0,.08);
      user-select: none;
    }
    .mobile-back .arrow{
      display:inline-block;
      margin-right: 6px;
      font-size: 18px;
      transform: translateY(-1px);
    }
  }

  /* 大屏不显示 */
  @media (min-width: 769px) {
    .mobile-back{ display:none; }
  }
</style>
